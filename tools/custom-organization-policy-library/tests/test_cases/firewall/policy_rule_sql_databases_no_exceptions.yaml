shared_config:
  command:  gcloud compute network-firewall-policies rules create 1000 --firewall-policy cuop-fw-policy --global-firewall-policy
  teardown_command: gcloud compute network-firewall-policies rules delete 1000 --firewall-policy cuop-fw-policy --global-firewall-policy
  default_command_flags:
      action: ALLOW
      direction: INGRESS
      enable-logging: true
  default_markers:
    - firewall
    - firewall-policy
    - sql-databases
    - firewall_no_exceptions

# These scenarios assume allowed_source_ranges is empty (no exceptions),
# so private ranges should be denied by policy rules.

firewall_policy_mysql_private_denied_when_no_exceptions:
  steps:
  - command_flags:
      layer4-configs: tcp:3306
      src-ip-ranges: 10.0.0.0/8
    expected_result:
      return_code: 1
      stderr: 'customConstraints/custom\.firewallRestrictSQLDatabasesPolicyRule'

firewall_policy_postgresql_private_denied_when_no_exceptions:
  steps:
  - command_flags:
      layer4-configs: tcp:5432
      src-ip-ranges: 172.16.0.0/12
    expected_result:
      return_code: 1
      stderr: 'customConstraints/custom\.firewallRestrictSQLDatabasesPolicyRule'
