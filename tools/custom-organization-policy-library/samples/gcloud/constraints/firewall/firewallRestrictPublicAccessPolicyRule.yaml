name: organizations/11111111/customConstraints/custom.firewallRestrictPublicAccessPolicyRule
resource_types:
- compute.googleapis.com/FirewallPolicy
condition: |-
  resource.rules.exists(rule,
    rule.priority < 2147483644 &&
    rule.direction == 'INGRESS' &&
    rule.match.srcIpRanges.exists(range, range == '0.0.0.0/0') &&
    !rule.match.layer4Configs.all(l4,
      l4.ipProtocol == 'icmp' ||
      (l4.ipProtocol == 'tcp' && has(l4.ports) && l4.ports.all(p, p == '22' || p == '443' || p == '3389')) ||
      (l4.ipProtocol == 'udp' && has(l4.ports) && l4.ports.all(p, p == '3389')) ||
      (l4.ipProtocol == 'sctp' && has(l4.ports) && l4.ports.all(p, p == '22'))
    )
  )
action_type: DENY
method_types:
- CREATE
- UPDATE
display_name: Restrict Firewall Policy rules allowing public Internet access
description: |-
  Prevent Firewall Policy rules from 0.0.0.0/0 except for allowed protocols (ICMP,
  TCP:22, TCP:443, TCP:3389, UDP:3389, SCTP:22).
