custom.iamDisableProjectServiceAccountImpersonationRoles:
  action_type: DENY
  condition: |-
    resource.bindings.exists(binding,
      binding.members.exists(member,
        !MemberSubjectMatches(member, ['user:my-user@my-project.com']) &&
        MemberSubjectStartsWith(member, ['user:', 'group:'])
      ) &&
      (
        RoleNameMatches(binding.role, ['roles/iam.serviceAccountUser']) ||
        RoleNameMatches(binding.role, ['roles/iam.serviceAccountTokenCreator'])
      )
    )
  description:
    Ensure that IAM Users are not assigned the service account user or service account token creator roles (requires
    usage of IAM Condition and tags to ensure the constraint is not applied on allowed service accounts)
  display_name: Deny assignement of the service account user or service account token creator roles to users
  method_types:
    - CREATE
    - UPDATE
  resource_types:
    - iam.googleapis.com/AllowPolicy
