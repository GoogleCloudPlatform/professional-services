gkeRequireNodePoolWorkloadIdentity:
  description: Detect if any GKE clusters is not using Workload Identity
  predicate:
    expression: resource.config.workloadMetadataConfig.mode != 'GKE_METADATA'
  recommendation: Ensure GKE node pools are configured to use Workload Identity
  resource_selector:
    resource_types:
      - container.googleapis.com/NodePool
  severity: MEDIUM
